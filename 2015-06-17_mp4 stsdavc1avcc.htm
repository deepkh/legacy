<blockquote>
<p><span style="color: #99cc00;"> 00 00 00 34</span> <span style="color: #33cccc;">61 76 63 43</span> <span style="color: #ff0000;">01 64 00</span> <span style="color: #ff0000;">28 </span><span style="color: #99cc00;"><strong>FF E1</strong></span> <span style="color: #00ff00;"><strong>00 1C</strong></span> ; ...4avcC.d.(....<br /> <span style="color: #ff9900;"> 67 64 00 28 AC 34 E4 00 80 06 FF 97 01 10 00 00 ; gd.(.4..€.......<br /> 03 00 10 00 00 03 03 00 F1 83 11 20 </span><span style="color: #3366ff;">01</span> <span style="color: #ff0000;">00 05</span> <span style="color: #0000ff;">68 ; ........... ...h<br /> EF B2 C8 B0</span> ; ....</p>
<p><span style="color: #99cc00;">00 00 00 34: box size<br /> </span><span style="color: #33cccc;">61 76 63 43: avc1<br /> </span><span style="color: #ff0000;">01 64 00</span>&nbsp;<span style="color: #ff0000;"><span style="color: #ff0000;">28: 01 (version) 64 (AVC profile_idc) 00 (AVC profile compatibility) 28 (AVC level indication)&nbsp;</span><br /><span style="color: #99cc00;"><strong>FF: FF /* 6 bits reserved (111111) + 2 bits nal size length - 1 (11) */)<br />The value of this field shall be one of 0, 1, or 3 corresponding to a length encoded with 1, 2, or 4 bytes, respectively.&nbsp;<br /><br /> </strong></span><span style="color: #99cc00;"><strong>E1: E1 (</strong></span><span style="color: #99cc00;"><strong>/* 3 bits reserved (111) + 5 bits number of sps (00001) */)<br /> </strong></span><strong>00 1C: sps_size 28<br /> </strong><span style="color: #ff9900;">67 64 00 ... : sps without start code (00 00 01)<br /> </span><span style="color: #3366ff;">01:&nbsp;</span><span style="color: #3366ff;">number of pps<br /> </span><span style="color: #ff0000;">00 05: pps size<br /> </span><span style="color: #0000ff;">68 </span><span style="color: #0000ff;">EF B2 C8 B0: pps&nbsp;</span></span></p>
<p><br />Now you should write H264 bitstream to mdat section and <span style="color: #ff0000;">startcode </span><span style="color: #ff0000;">(00 00 01)</span> insteaof <span style="color: #ff0000;">nal size </span>. And the <span style="color: #99cc00;"><strong>nal size length</strong></span> is specified as&nbsp;<span style="color: #99cc00; font-weight: bold;"><strong>FF.</strong><span style="color: #000000;"> It's 4 bytes declared here.</span><strong>&nbsp;<br /><br />Example:<br /></strong></span><strong>00 00 00 3F <span style="color: #3366ff;">41 9E 42 42 FF 00 00 03 00 00 03 00 ; ...?A.BB........<br /></span></strong><span style="color: #3366ff;"><span style="color: #3366ff;"><strong><span style="color: #3366ff;">00 03 00 00 03 00 00 03 00 00 03 00 00 03 00 00 ; ................</span><br /></strong><strong><span style="color: #3366ff;">03 00 00 03 00 00 03 00 00 03 00 00 03 00 00 03 ; ................</span><br /></strong></span><strong><span style="color: #3366ff;">00 00 03 00 00 03 00 00 03 00 00 03 00 00 03 00 ; ................</span><br /></strong></span><strong><span style="color: #3366ff;">00 EA 81 &nbsp; &nbsp;</span> &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp;; ...</strong></p>
<div><strong>00 00 00 3F is the length of &nbsp;</strong><strong><span style="color: #3366ff;">41 9E 42 42 &nbsp;... 00 EA 81</span></strong></div>
<p><span style="color: #99cc00; font-weight: bold;"><strong>&nbsp;</strong></span></p>
<p>Reference:<br />ffmpeg-2.7/libavformat/avc.c: ff_isom_write_avcc&nbsp;<br />ISO/IEC 14496-15: http://www.nhzjj.com/asp/admin/editor/newsfile/201011314552121.pdf&nbsp;</p>
</blockquote>
